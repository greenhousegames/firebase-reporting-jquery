{"version":3,"sources":["app/app.js","app/click-report.js","app/firebase-client.js","app/reporting-service.js"],"names":["document","foundation","firebaseClient","requireAuth","reportingService","firebase","report","ready","loadCharts","then","draw","jQuery","click","saveButtonClicked","window","resize","onDataSaved","ClickReport","reporting","done","google","charts","load","setOnLoadCallback","drawTotalClicked","drawTotalUsers","drawLastClicked","drawPieChart","drawLineChart","id","during","title","queryStartTime","Date","queryEndTime","setMilliseconds","setSeconds","setMinutes","setTime","getTime","setHours","getHours","setDate","getDate","setMonth","getMonth","setFullYear","getFullYear","aClickedQuery","where","sum","range","values","bClickedQuery","cClickedQuery","dClickedQuery","all","element","chartdata","i","length","push","timestamp","value","data","visualization","arrayToDataTable","options","width","height","legend","position","chart","LineChart","PieChart","query","select","text","catch","err","console","log","count","last","date","toLocaleString","module","exports","FirebaseClient","initializeApp","apiKey","authDomain","databaseURL","storageBucket","messagingSenderId","dataRef","database","ref","button","uid","auth","currentUser","ServerValue","TIMESTAMP","anyclicked","saveMetrics","set","cb","orderByChild","limitToLast","once","snapshot","val","keys","Object","startAt","on","promise","Promise","resolve","callback","off","onAuthStateChanged","reject","waitForAuth","signInAnonymously","ReportingService","addFilter","addMetric","enableRetainer"],"mappings":"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","file":"public/assets/js/app.js","sourcesContent":["import firebase from 'firebase';\nimport $ from 'jquery';\nimport ReportingService from './reporting-service';\nimport FirebaseClient from './firebase-client';\nimport ClickReport from './click-report';\n\n$(document).foundation();\n\n// setup firebase\nconst firebaseClient = new FirebaseClient();\nfirebaseClient.requireAuth(); // initiate login\n\n// setup reporting\nconst reportingService = new ReportingService(firebaseClient.firebase);\nconst report = new ClickReport(reportingService);\n\n$(document).ready(() => {\n  // draw charts once page is loaded and user is authenticated\n  report.loadCharts(() => {\n    firebaseClient.requireAuth().then(() => {\n      report.draw();\n    });\n  });\n\n  // setup buttons\n  jQuery('#a_button').click(() => {\n    firebaseClient.saveButtonClicked('a', reportingService);\n  });\n  jQuery('#b_button').click(() => {\n    firebaseClient.saveButtonClicked('b', reportingService);\n  });\n  jQuery('#c_button').click(() => {\n    firebaseClient.saveButtonClicked('c', reportingService);\n  });\n  jQuery('#d_button').click(() => {\n    firebaseClient.saveButtonClicked('d', reportingService);\n  });\n\n  // make charts responsive\n  $(window).resize(() => {\n    report.draw();\n  });\n\n  // update report when data saved\n  firebaseClient.onDataSaved(() => {\n    report.draw();\n  });\n});\n","import rsvp from 'rsvp';\n\nclass ClickReport {\n  constructor(reporting) {\n    this.reporting = reporting;\n  }\n\n  loadCharts(done) {\n    google.charts.load('current', {'packages':['corechart']});\n    google.charts.setOnLoadCallback(done);\n  }\n\n  draw() {\n    this.drawTotalClicked();\n    this.drawTotalUsers();\n    this.drawLastClicked();\n    this.drawPieChart('pie_chart_div');\n    this.drawLineChart('line_chart_div', 'minute');\n    this.drawLineChart('line_chart_div2', 'hour');\n    this.drawLineChart('line_chart_div3', 'day');\n    this.drawLineChart('line_chart_div4', 'week');\n  }\n\n  drawLineChart(id, during) {\n    let title;\n    const queryStartTime = new Date();\n    const queryEndTime = new Date();\n    queryStartTime.setMilliseconds(0);\n    queryStartTime.setSeconds(0);\n    queryStartTime.setMinutes(0);\n\n    switch (during) {\n      case 'minute':\n        title = 'Clicked this Hour';\n        queryEndTime.setTime(queryStartTime.getTime());\n        queryEndTime.setHours(queryStartTime.getHours() + 1);\n        break;\n      case 'hour':\n        title = 'Clicked Today';\n        queryStartTime.setHours(0);\n        queryEndTime.setTime(queryStartTime.getTime());\n        queryEndTime.setDate(queryStartTime.getDate() + 1);\n        break;\n      case 'day':\n        title = 'Clicked this Month';\n        queryStartTime.setHours(0);\n        queryStartTime.setDate(1);\n        queryEndTime.setTime(queryStartTime.getTime());\n        queryEndTime.setMonth(queryStartTime.getMonth() + 1);\n        break;\n      case 'week':\n        title = 'Clicked this Year';\n        queryStartTime.setHours(0);\n        queryStartTime.setDate(1);\n        queryStartTime.setMonth(1);\n        queryEndTime.setTime(queryStartTime.getTime());\n        queryEndTime.setFullYear(queryStartTime.getFullYear() + 1);\n        break;\n    }\n\n    const aClickedQuery = this.reporting.where().sum('aclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n    const bClickedQuery = this.reporting.where().sum('bclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n    const cClickedQuery = this.reporting.where().sum('cclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n    const dClickedQuery = this.reporting.where().sum('dclicked').during(during).range(queryStartTime.getTime(), queryEndTime.getTime()).values(true);\n\n    rsvp.all([aClickedQuery, bClickedQuery, cClickedQuery, dClickedQuery]).then(function(values) {\n      var element = jQuery('#' + id);\n      var chartdata = [['Time', 'A', 'B', 'C', 'D']];\n      for (var i = 0; i < values[0].length; i++) {\n        chartdata.push([new Date(values[0][i].timestamp), values[0][i].value, values[1][i].value, values[2][i].value, values[3][i].value]);\n      }\n      var data = new google.visualization.arrayToDataTable(chartdata);\n\n      // Set chart options\n      var options = {\n         title: title,\n         width: element.width(),\n         height: 400,\n         legend: { position: 'bottom' }\n      };\n\n      // Instantiate and draw our chart, passing in some options.\n      var chart = new google.visualization.LineChart(element[0]);\n      chart.draw(data, options);\n    });\n  }\n\n  drawPieChart(id) {\n    const aClickedQuery = this.reporting.where().sum('aclicked').value();\n    const bClickedQuery = this.reporting.where().sum('bclicked').value();\n    const cClickedQuery = this.reporting.where().sum('cclicked').value();\n    const dClickedQuery = this.reporting.where().sum('dclicked').value();\n\n    rsvp.all([aClickedQuery, bClickedQuery, cClickedQuery, dClickedQuery]).then(function(values) {\n      var element = jQuery('#' + id);\n      var data = new google.visualization.arrayToDataTable([\n        ['Button', 'Times Clicked'],\n        ['A', values[0]],\n        ['B', values[1]],\n        ['C', values[2]],\n        ['D', values[3]]\n      ]);\n\n      // Set chart options\n      var options = {\n         width: element.width(),\n         height: 400,\n         legend: { position: 'bottom' }\n      };\n\n      // Instantiate and draw our chart, passing in some options.\n      var chart = new google.visualization.PieChart(element[0]);\n      chart.draw(data, options);\n    });\n  }\n\n  drawTotalClicked() {\n    const query = this.reporting.where().sum('anyclicked').select(1);\n\n    query.then(function(values) {\n      jQuery('#total_clicked_count').text(values[0] || 0);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  drawTotalUsers() {\n    const query = this.reporting.where('users').sum('anyclicked').count();\n\n    query.then(function(value) {\n      jQuery('#total_users_count').text(value || 0);\n    }).catch(function(err) { console.log(err); });\n  }\n\n  drawLastClicked() {\n    const query = this.reporting.where().last('timestamp').select(1);\n\n    query.then(function(values) {\n      if (values.length === 0) {\n        jQuery('#last_clicked_time').text('never');\n      } else {\n        var date = new Date();\n        date.setTime(values[0]);\n        jQuery('#last_clicked_time').text(date.toLocaleString());\n      }\n    }).catch(function(err) { console.log(err); });\n  }\n}\n\nmodule.exports = ClickReport;\n","import firebase from 'firebase';\nimport rsvp from 'rsvp';\n\nclass FirebaseClient {\n  constructor() {\n    this.firebase = firebase.initializeApp({\n      apiKey: 'AIzaSyDRf-RxCxWRecif5l-q2ZMEQ595ohApojs',\n      authDomain: 'fir-reporting.firebaseapp.com',\n      databaseURL: 'https://fir-reporting.firebaseio.com',\n      storageBucket: '',\n      messagingSenderId: '275159253276'\n    });\n    this.dataRef = this.firebase.database().ref('data');\n  }\n\n  saveButtonClicked(button, reportingService) {\n    const data = {\n      uid: this.firebase.auth().currentUser.uid,\n      timestamp: firebase.database.ServerValue.TIMESTAMP,\n      anyclicked: 1\n    };\n    data[button + 'clicked'] = 1;\n\n    // save metrics first to ensure onDataSaved callback\n    // is called after metrics have been calculated\n    reportingService.saveMetrics(data).then(() => {\n      this.dataRef.push().set(data);\n    });\n  }\n\n  onDataSaved(cb) {\n    let query = this.dataRef.orderByChild('timestamp');\n    query.limitToLast(1).once('value', (snapshot) => {\n      const data = snapshot.val();\n      const keys = data ? Object.keys(data) : null;\n\n      if (keys && keys.length > 0) {\n        query = query.startAt(data[keys[0]].timestamp + 1);\n      }\n\n      // setup listener\n      query.on('child_added', cb);\n    });\n  }\n\n  waitForAuth() {\n    const auth = this.firebase.auth();\n    const promise = new rsvp.Promise((resolve) => {\n      const callback = () => {\n        off();\n        resolve();\n      };\n      const off = auth.onAuthStateChanged(callback);\n    });\n    return promise;\n  }\n\n  requireAuth() {\n    const promise = new rsvp.Promise((resolve, reject) => {\n      this.waitForAuth().then(() => {\n        if (!this.firebase.auth().currentUser) {\n          this.firebase.auth().signInAnonymously().then(resolve).catch(reject);\n        } else {\n          resolve();\n        }\n      }).catch(reject);\n    });\n    return promise;\n  }\n}\n\nmodule.exports = FirebaseClient;\n","import FirebaseReporting from 'firebase-reporting';\n\nclass ReportingService extends FirebaseReporting {\n  constructor(firebase) {\n    super({\n      firebase: firebase.database().ref('reporting')\n    });\n\n    // Add report filter for users\n    this.addFilter('users', ['uid']);\n\n    // Metrics for timing\n    this.addMetric('timestamp', ['first', 'last']);\n\n    // Metrics for ANY button clicked\n    this.addMetric('anyclicked', ['sum']);\n    this.enableRetainer('minute', 'anyclicked', ['sum']);\n    this.enableRetainer('hour', 'anyclicked', ['sum']);\n    this.enableRetainer('day', 'anyclicked', ['sum']);\n    this.enableRetainer('week', 'anyclicked', ['sum']);\n\n    // Metrics for A button clicked\n    this.addMetric('aclicked', ['sum']);\n    this.enableRetainer('minute', 'aclicked', ['sum']);\n    this.enableRetainer('hour', 'aclicked', ['sum']);\n    this.enableRetainer('day', 'aclicked', ['sum']);\n    this.enableRetainer('week', 'aclicked', ['sum']);\n\n    // Metrics for B button clicked\n    this.addMetric('bclicked', ['sum']);\n    this.enableRetainer('minute', 'bclicked', ['sum']);\n    this.enableRetainer('hour', 'bclicked', ['sum']);\n    this.enableRetainer('day', 'bclicked', ['sum']);\n    this.enableRetainer('week', 'bclicked', ['sum']);\n\n    // Metrics for C button clicked\n    this.addMetric('cclicked', ['sum']);\n    this.enableRetainer('minute', 'cclicked', ['sum']);\n    this.enableRetainer('hour', 'cclicked', ['sum']);\n    this.enableRetainer('day', 'cclicked', ['sum']);\n    this.enableRetainer('week', 'cclicked', ['sum']);\n\n    // Metrics for D button clicked\n    this.addMetric('dclicked', ['sum']);\n    this.enableRetainer('minute', 'dclicked', ['sum']);\n    this.enableRetainer('hour', 'dclicked', ['sum']);\n    this.enableRetainer('day', 'dclicked', ['sum']);\n    this.enableRetainer('week', 'dclicked', ['sum']);\n  }\n}\n\nmodule.exports = ReportingService;\n"]}